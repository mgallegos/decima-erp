(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var m=c.jgrid;c.fn.jqFilter=function(f){if("string"===typeof f){var r=c.fn.jqFilter[f];if(!r)throw"jqFilter - No such method: "+f;var D=c.makeArray(arguments).slice(1);return r.apply(this,D)}var b=c.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,
sopt:null,ops:[],operands:null,numopts:"eq ne lt le gt ge nu nn in ni".split(" "),stropts:"eq ne bw bn ew en cn nc nu nn in ni".split(" "),strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},m.filter,f||{});return this.each(function(){if(!this.filter){this.p=b;if(null===b.filter||void 0===b.filter)b.filter={groupOp:b.groupOps[0].op,rules:[],groups:[]};var f,r=b.columns.length,g,F=/msie/i.test(navigator.userAgent)&&!window.opera,
x=c.isFunction,G=null!=m.defaults&&x(m.defaults.fatalError)?m.defaults.fatalError:alert,v=function(){return c("#"+m.jqID(b.id))[0]||null},q=function(d,b){return c(v()).jqGrid("getGuiStyles",d,b||"")},B=function(d){return c(v()).jqGrid("getGridRes","search."+d)},H=function(c){var d=v(),a=d.p.iColByName[c];if(void 0!==a)return{cm:d.p.colModel[a],iCol:a};a=d.p.iPropByName[c];return void 0!==a?{cm:d.p.colModel[a],iCol:a,isAddProp:!0}:{cm:null,iCol:-1}},E=q("states.error"),D=q("dialog.content");b.initFilter=
c.extend(!0,{},b.filter);if(r){for(f=0;f<r;f++)g=b.columns[f],g.stype?g.inputtype=g.stype:g.inputtype||(g.inputtype="text"),g.sorttype?g.searchtype=g.sorttype:g.searchtype||(g.searchtype="string"),void 0===g.hidden&&(g.hidden=!1),g.label||(g.label=g.name),g.cmName=g.name,g.index&&(g.name=g.index),g.hasOwnProperty("searchoptions")||(g.searchoptions={}),g.hasOwnProperty("searchrules")||(g.searchrules={});b.showQuery&&c(this).append("<table class='queryresult "+D+"' style='display:block;max-width:440px;border:0px none;' dir='"+
b.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var I=function(c,n){var a=[!0,""],d=v();if(x(n.searchrules))a=n.searchrules.call(d,c,n);else if(m&&m.checkValues)try{a=m.checkValues.call(d,c,-1,n.searchrules,n.label)}catch(t){}a&&a.length&&!1===a[0]&&(b.error=!a[0],b.errmsg=a[1])};this.onchange=function(){b.error=!1;b.errmsg="";return x(b.onChange)?b.onChange.call(v(),b,this):!1};this.reDraw=function(){c("table.group:first",this).remove();var d=this.createTableForGroup(b.filter,
null);c(this).append(d);x(b.afterRedraw)&&b.afterRedraw.call(v(),b,this)};this.createTableForGroup=function(d,n){var a=this,h,t=c("<table class='"+q("searchDialog.operationGroup","group")+"' style='border:0px none;'><tbody></tbody></table>"),e="left";"rtl"===b.direction&&(e="right",t.attr("dir","rtl"));null===n&&t.append("<tr class='error' style='display:none;'><th colspan='5' class='"+E+"' align='"+e+"'></th></tr>");var k=c("<tr></tr>");t.append(k);e=c("<th colspan='5' align='"+e+"'></th>");k.append(e);
if(!0===b.ruleButtons){var g=c("<select class='"+q("searchDialog.operationSelect","opsel")+"'></select>");e.append(g);var k="",f;for(h=0;h<b.groupOps.length;h++)f=d.groupOp===a.p.groupOps[h].op?" selected='selected'":"",k+="<option value='"+a.p.groupOps[h].op+"'"+f+">"+a.p.groupOps[h].text+"</option>";g.append(k).on("change",function(){d.groupOp=c(g).val();a.onchange()})}k="<span></span>";b.groupButton&&(k=c("<input type='button' value='+ {}' title='"+B("addGroupTitle")+"' class='"+q("searchDialog.addGroupButton",
"add-group")+"'/>"),k.on("click",function(){void 0===d.groups&&(d.groups=[]);d.groups.push({groupOp:b.groupOps[0].op,rules:[],groups:[]});a.reDraw();a.onchange();return!1}));e.append(k);if(!0===b.ruleButtons){var k=c("<input type='button' value='+' title='"+B("addRuleTitle")+"' class='"+q("searchDialog.addRuleButton","add-rule ui-add")+"'/>"),m;k.on("click",function(){var b,e,k;void 0===d.rules&&(d.rules=[]);for(h=0;h<a.p.columns.length;h++)if(b=void 0===a.p.columns[h].search?!0:a.p.columns[h].search,
e=!0===a.p.columns[h].hidden,(k=!0===a.p.columns[h].searchoptions.searchhidden)&&b||b&&!e){m=a.p.columns[h];break}b=m.searchoptions.sopt?m.searchoptions.sopt:a.p.sopt?a.p.sopt:-1!==c.inArray(m.searchtype,a.p.strarr)?a.p.stropts:a.p.numopts;d.rules.push({field:m.name,op:b[0],data:""});a.reDraw();return!1});e.append(k)}null!==n&&(k=c("<input type='button' value='-' title='"+B("deleteGroupTitle")+"' class='"+q("searchDialog.deleteGroupButton","delete-group")+"'/>"),e.append(k),k.on("click",function(){for(h=
0;h<n.groups.length;h++)if(n.groups[h]===d){n.groups.splice(h,1);break}a.reDraw();a.onchange();return!1}));if(void 0!==d.groups)for(h=0;h<d.groups.length;h++)e=c("<tr></tr>"),t.append(e),k=c("<td class='first'></td>"),e.append(k),k=c("<td colspan='4'></td>"),k.append(this.createTableForGroup(d.groups[h],d)),e.append(k);void 0===d.groupOp&&(d.groupOp=a.p.groupOps[0].op);if(void 0!==d.rules)for(h=0;h<d.rules.length;h++)t.append(this.createTableRowForRule(d.rules[h],d));return t};this.createTableRowForRule=
function(d,n){var a=this,h=v(),g=c("<tr></tr>"),e,k,f,p="",u;g.append("<td class='first'></td>");var l=c("<td class='columns'></td>");g.append(l);var r=c("<select class='"+q("searchDialog.label","selectLabel")+"'></select>"),y,w=[];l.append(r);r.on("change",function(){d.field=c(r).val();var b=c(this).parents("tr:first"),e,f;for(f=0;f<a.p.columns.length;f++)if(a.p.columns[f].name===d.field){e=a.p.columns[f];break}if(e){f=c.extend({},e.editoptions||{});delete f.readonly;delete f.disabled;var g=c.extend({},
f||{},e.searchoptions||{},H(e.cmName),{id:m.randId(),name:e.name,mode:"search"});g.column=e;F&&"text"===e.inputtype&&!g.size&&(g.size=10);var n=m.createEl.call(h,e.inputtype,g,"",!0,a.p.ajaxSelectOptions||{},!0);c(n).addClass(q("searchDialog.elem","input-elm"));k=g.sopt?g.sopt:a.p.sopt?a.p.sopt:-1!==c.inArray(e.searchtype,a.p.strarr)?a.p.stropts:a.p.numopts;e="";var t=0,l,p;w=[];c.each(a.p.ops,function(){w.push(this.oper)});a.p.cops&&c.each(a.p.cops,function(a){w.push(a)});for(f=0;f<k.length;f++)p=
k[f],y=c.inArray(k[f],w),-1!==y&&(l=a.p.ops[y],l=void 0!==l?l.text:a.p.cops[p].text,0===t&&(d.op=p),e+="<option value='"+p+"'>"+l+"</option>",t++);c(".selectopts",b).empty().append(e);c(".selectopts",b)[0].selectedIndex=0;m.msie&&9>m.msiever()&&(f=parseInt(c("select.selectopts",b)[0].offsetWidth,10)+1,c(".selectopts",b).width(f),c(".selectopts",b).css("width","auto"));c(".data",b).empty().append(n);m.bindEv.call(h,n,g);c(".input-elm",b).on("change",function(b){b=b.target;d.data="SPAN"===b.nodeName.toUpperCase()&&
g&&x(g.custom_value)?g.custom_value.call(h,c(b).children(".customelement:first"),"get"):b.value;a.onchange()});setTimeout(function(){d.data=c(n).val();a.onchange()},0)}});var l=0,z,A;for(e=0;e<a.p.columns.length;e++)if(u=void 0===a.p.columns[e].search?!0:a.p.columns[e].search,z=!0===a.p.columns[e].hidden,(A=!0===a.p.columns[e].searchoptions.searchhidden)&&u||u&&!z)u="",d.field===a.p.columns[e].name&&(u=" selected='selected'",l=e),p+="<option value='"+a.p.columns[e].name+"'"+u+">"+a.p.columns[e].label+
"</option>";r.append(p);p=c("<td class='operators'></td>");g.append(p);f=b.columns[l];F&&"text"===f.inputtype&&!f.searchoptions.size&&(f.searchoptions.size=10);l=c.extend({},f.editoptions||{});delete l.readonly;delete l.disabled;l=c.extend({},l,f.searchoptions||{},H(f.cmName),{id:m.randId(),name:f.name});l.column=f;l=m.createEl.call(h,f.inputtype,l,d.data,!0,a.p.ajaxSelectOptions||{},!0);if("nu"===d.op||"nn"===d.op)c(l).attr("readonly","true"),c(l).attr("disabled","true");var C=c("<select class='"+
q("searchDialog.operator","selectopts")+"'></select>");p.append(C);C.on("change",function(){d.op=c(C).val();var b=c(this).parents("tr:first"),b=c(".input-elm",b)[0];"nu"===d.op||"nn"===d.op?(d.data="","SELECT"!==b.tagName.toUpperCase()&&(b.value=""),b.setAttribute("readonly","true"),b.setAttribute("disabled","true")):("SELECT"===b.tagName.toUpperCase()&&(d.data=b.value),b.removeAttribute("readonly"),b.removeAttribute("disabled"));a.onchange()});k=f.searchoptions.sopt?f.searchoptions.sopt:a.p.sopt?
a.p.sopt:-1!==c.inArray(f.searchtype,a.p.strarr)?a.p.stropts:a.p.numopts;p="";c.each(a.p.ops,function(){w.push(this.oper)});a.p.cops&&c.each(a.p.cops,function(a){w.push(a)});for(e=0;e<k.length;e++)A=k[e],y=c.inArray(k[e],w),-1!==y&&(z=a.p.ops[y],u=d.op===A?" selected='selected'":"",p+="<option value='"+A+"'"+u+">"+(void 0!==z?z.text:a.p.cops[A].text)+"</option>");C.append(p);p=c("<td class='data'></td>");g.append(p);p.append(l);m.bindEv.call(h,l,f.searchoptions);c(l).addClass(q("searchDialog.elem",
"input-elm")).on("change",function(){d.data="custom"===f.inputtype?f.searchoptions.custom_value.call(h,c(this).children(".customelement:first"),"get"):c(this).val();a.onchange()});p=c("<td></td>");g.append(p);!0===b.ruleButtons&&(l=c("<input type='button' value='-' title='"+B("deleteRuleTitle")+"' class='"+q("searchDialog.deleteRuleButton","delete-rule ui-del")+"'/>"),p.append(l),l.on("click",function(){for(e=0;e<n.rules.length;e++)if(n.rules[e]===d){n.rules.splice(e,1);break}a.reDraw();a.onchange();
return!1}));return g};this.getStringForGroup=function(b){var c="(",a;if(void 0!==b.groups)for(a=0;a<b.groups.length;a++){1<c.length&&(c+=" "+b.groupOp+" ");try{c+=this.getStringForGroup(b.groups[a])}catch(h){G(h)}}if(void 0!==b.rules)try{for(a=0;a<b.rules.length;a++)1<c.length&&(c+=" "+b.groupOp+" "),c+=this.getStringForRule(b.rules[a])}catch(h){G(h)}c+=")";return"()"===c?"":c};this.getStringForRule=function(d){var f="",a="",h,g,e=d.data,k;for(h=0;h<b.ops.length;h++)if(b.ops[h].oper===d.op){f=b.operands.hasOwnProperty(d.op)?
b.operands[d.op]:"";a=b.ops[h].oper;break}if(""===a&&null!=b.cops)for(k in b.cops)if(b.cops.hasOwnProperty(k)&&(a=k,f=b.cops[k].operand,x(b.cops[k].buildQueryValue)))return b.cops[k].buildQueryValue.call(b,{cmName:d.field,searchValue:e,operand:f});for(h=0;h<b.columns.length;h++)if(b.columns[h].name===d.field){g=b.columns[h];break}if(null==g)return"";if("bw"===a||"bn"===a)e+="%";if("ew"===a||"en"===a)e="%"+e;if("cn"===a||"nc"===a)e="%"+e+"%";if("in"===a||"ni"===a)e=" ("+e+")";b.errorcheck&&I(d.data,
g);return-1!==c.inArray(g.searchtype,["int","integer","float","number","currency"])||"nn"===a||"nu"===a?d.field+" "+f+" "+e:d.field+" "+f+' "'+e+'"'};this.resetFilter=function(){b.filter=c.extend(!0,{},b.initFilter);this.reDraw();this.onchange()};this.hideError=function(){c("th."+E,this).html("");c("tr.error",this).hide()};this.showError=function(){c("th."+E,this).html(b.errmsg);c("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(b.filter)};this.toString=
function(){function c(a){var b="(",d;if(void 0!==a.groups)for(d=0;d<a.groups.length;d++)1<b.length&&(b="OR"===a.groupOp?b+" || ":b+" && "),b+=c(a.groups[d]);if(void 0!==a.rules)for(d=0;d<a.rules.length;d++){1<b.length&&(b="OR"===a.groupOp?b+" || ":b+" && ");var e=a.rules[d];if(f.p.errorcheck){var g,m=void 0;for(g=0;g<f.p.columns.length;g++)if(f.p.columns[g].name===e.field){m=f.p.columns[g];break}m&&I(e.data,m)}b+=e.op+"(item."+e.field+",'"+e.data+"')"}b+=")";return"()"===b?"":b}var f=this;return c(b.filter)};
this.reDraw();if(b.showQuery)this.onchange();this.filter=!0}}})};c.extend(c.fn.jqFilter,{toSQLString:function(){var c="";this.each(function(){c=this.toUserFriendlyString()});return c},filterData:function(){var c;this.each(function(){c=this.p.filter});return c},getParameter:function(c){return void 0!==c&&this.p.hasOwnProperty(c)?this.p[c]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(f){"string"===typeof f&&(f=c.parseJSON(f));this.each(function(){this.p.filter=
f;this.reDraw();this.onchange()})}})});
//# sourceMappingURL=grid.filter.map
